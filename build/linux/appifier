#!/usr/bin/env ruby
require "bundler"
require "fileutils"
Bundler.setup
Bundler.require :default

# Usage: appifier appify Release
class App < Thor
  # Automatically created tar ball from MD
  ORIG_PKG_NAME = "humanrightstracker-0.1"
  PKG_SOURCE_CODE = File.join(File.dirname(__FILE__), "../../#{ORIG_PKG_NAME}.tar.gz")

  VERSION = "1.0.12"
  PKG_NAME = "humanrightstracker-#{VERSION}"
  PKG_TARBALL = "#{PKG_NAME}.tar.gz"
  DST_SOURCE_CODE = File.join(File.dirname(__FILE__), PKG_NAME)
  LAUNCHER_SCRIPT = File.join(File.dirname(__FILE__), "lib/humanrightstracker.in")
  MKFILE = File.join(File.dirname(__FILE__), "lib/Makefile.am")

  desc "tarball", "Creates the tarball for linux"
  def tarball 
    clean
    puts "Uncompressing #{PKG_SOURCE_CODE}"
    system "tar xfz #{PKG_SOURCE_CODE}"
    FileUtils.mv ORIG_PKG_NAME, PKG_NAME
    if Dir.exists? PKG_NAME
      FileUtils.copy_file LAUNCHER_SCRIPT, "#{DST_SOURCE_CODE}/HumanRightsTracker/humanrightstracker.in", true, true
      FileUtils.copy_file MKFILE, "#{DST_SOURCE_CODE}/HumanRightsTracker/Makefile.am", true, true
      FileUtils.cd DST_SOURCE_CODE
      system "automake"
    end
  end

  desc "clean", "Deletes the tarball for linux"
  def clean
    if Dir.exists? PKG_NAME
      FileUtils.rm_rf PKG_NAME
    end
  end
end

App.start
